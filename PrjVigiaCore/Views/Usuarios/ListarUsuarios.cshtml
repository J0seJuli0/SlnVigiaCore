@model List<dynamic>
@{
    ViewData["Title"] = "Lista de Empleados";
    Layout = "~/Views/Shared/_LayoutTemporal.cshtml";
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<link href="~/css/Login/ListarUsuarios.css" rel="stylesheet" />


<div class="main-container">
    <div class="main-card">
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-users me-2"></i>Lista de Empleados
            </h1>
            <div class="action-buttons">
                <button class="btn btn-primary" id="btnAddEmployee">
                    <i class="fas fa-plus"></i> Nuevo
                </button>
                <button class="btn btn-primary" id="btnRefresh">
                    <i class="fas fa-sync-alt"></i> Actualizar
                </button>
                <button class="btn btn-success" id="btnExportExcel">
                    <i class="fas fa-file-excel"></i> Exportar Excel
                </button>
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="input-group search-box" style="width: 300px;">
                        <input type="text" id="searchInput" class="form-control" placeholder="Buscar...">
                        <button class="btn btn-light" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        @if (ViewBag.Error != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>@ViewBag.Error
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        else if (Model.Count == 0)
        {
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <i class="fas fa-info-circle me-2"></i>No se encontraron empleados.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table id="tablaEmpleados" class="display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th style="display: none;">ID</th>
                            <th>DNI</th>
                            <th>Foto</th>
                            <th>Nombre</th>
                            <th>Usuario</th>
                            <th>Edad</th>
                            <th>Género</th>
                            <th>Grupos Asignados</th>
                            <th>Email</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var emp in Model)
                        {
                            <tr>
                                <td style="display: none;">@emp.ID_EMPLEADO</td>
                                <td>@emp.DNI</td>
                                <td>
                                    @if (!string.IsNullOrEmpty((string)emp.IMAGE_PATH))
                                    {
                                        <img src="@emp.IMAGE_PATH" alt="Foto" class="profile-img" />
                                    }
                                    else
                                    {
                                        <div class="profile-img bg-light d-flex align-items-center justify-content-center">
                                            <i class="fas fa-user text-muted"></i>
                                        </div>
                                    }
                                </td>
                                <td>
                                    <strong>@emp.NOMBRE_COMPLETO</strong>
                                    <div class="text-muted small">@emp.DIRECCION_COMPLETA</div>
                                </td>
                                <td>@emp.USUARIO</td>
                                <td>@emp.EDAD</td>
                                <td>@emp.GENERO</td>
                                <td>
                                    @if (!string.IsNullOrEmpty((string)emp.GRUPOS_ASIGNADOS))
                                    {
                                        foreach (var grupo in ((string)emp.GRUPOS_ASIGNADOS).Split(','))
                                        {
                                            <span class="badge bg-primary me-1 mb-1">@grupo.Trim()</span>
                                        }
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">SIN GRUPO</span>
                                    }
                                </td>
                                <td>
                                    <a href="mailto:@emp.EMAIL" class="text-primary">@emp.EMAIL</a>
                                </td>
                                <td>
                                    <span class="badge bg-success">Activo</span>
                                </td>
                                <td class="text-center">
                                    <button class="action-btn btn btn-sm btn-view" data-id="@emp.ID_EMPLEADO" title="Ver">
                                        <i class="fas fa-eye"></i>
                                    </button>

                                    <button class="action-btn btn btn-sm btn-edit" data-id="@emp.ID_EMPLEADO" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>


<div class="modal fade" id="modalEmpleado" tabindex="-1" aria-labelledby="modalEmpleadoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <div id="contenidoEmpleado">
                    <!-- Aquí se carga dinámicamente el contenido -->
                    <div class="text-center">Cargando...</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>

    $(document).ready(function () {

            // Función de búsqueda simple y limpia
            function initializeSearch() {
                $('#searchInput').on('keyup', function() {
                    const searchTerm = $(this).val().toLowerCase().trim();
                    const $tableRows = $('#tablaEmpleados tbody tr');

                    if (searchTerm === '') {
                        // Mostrar todas las filas
                        $tableRows.show();
                        $('.search-results-info').remove();
                    } else {
                        let visibleCount = 0;

                        $tableRows.each(function() {
                            const $row = $(this);
                            let found = false;

                            // Buscar solo en el texto visible (sin HTML)
                            $row.find('td:not(:last-child)').each(function() {
                                const cellText = $(this).text().toLowerCase();
                                if (cellText.includes(searchTerm)) {
                                    found = true;
                                    return false; // Salir del bucle
                                }
                            });

                            if (found) {
                                $row.show();
                                visibleCount++;
                            } else {
                                $row.hide();
                            }
                        });

                        // Mostrar información de resultados
                        updateResultsInfo(visibleCount, $tableRows.length);
                    }
                });

                // Limpiar búsqueda con el botón
                $('.btn-light').on('click', function() {
                    $('#searchInput').val('');
                    $('#tablaEmpleados tbody tr').show();
                    $('.search-results-info').remove();
                    $('#searchInput').focus();
                });
            }

            // Función para mostrar información de resultados
            function updateResultsInfo(visible, total) {
                $('.search-results-info').remove();

                if (visible !== total) {
                    const message = visible === 0 ?
                        'No se encontraron resultados que coincidan con la búsqueda' :
                        `Mostrando ${visible} resultado de ${total} registros`;

                    $('#tablaEmpleados').before(`
                        <div class="search-results-info alert alert-info d-flex align-items-center mb-3" role="alert">
                            <i class="fas fa-search me-2"></i>
                            <span>${message}</span>
                            <button type="button" class="btn-close ms-auto" onclick="clearSearch()"></button>
                        </div>
                    `);
                }
            }

            // Función global para limpiar búsqueda
            window.clearSearch = function() {
                $('#searchInput').val('');
                $('#tablaEmpleados tbody tr').show();
                $('.search-results-info').remove();
            };

            // Inicializar la búsqueda
            initializeSearch();

            $('#btnRefresh').click(function() {
            const $btn = $(this);

            // 1. Mostrar estado de carga
            $btn.html('<i class="fas fa-sync-alt fa-spin"></i> Actualizando...').prop('disabled', true);

            // 2. Intentar recargar con DataTables si está disponible
            if ($.fn.DataTable && $('#tablaEmpleados').DataTable()) {
                $('#tablaEmpleados').DataTable().ajax.reload(null, false);
            }
            // 3. Si falla, recargar toda la página
            else {
                location.reload(true);
            }

            // 4. Restaurar botón después de 3 segundos (solo como fallback)
            setTimeout(() => {
                $btn.html('<i class="fas fa-sync-alt"></i> Actualizar').prop('disabled', false);
            }, 3000);
        });


        $('#btnExportExcel').click(function () {
        const originalHtml = $(this).html();
        $(this).html('<i class="fas fa-spinner fa-spin"></i> Generando Excel...').prop('disabled', true);

        let html = '<table border="1">';

        // Índices de columnas que deseas excluir (ID = 0, Nombre = 2)
        const excludeIndexes = [0, 2];

        // Encabezados
        html += '<thead><tr>';
        $('#tablaEmpleados thead th').each(function (index) {
            const isLast = index === $('#tablaEmpleados thead th').length - 1;
            if (!excludeIndexes.includes(index) && !isLast) {
                html += '<th style="background-color: #f8f9fa; font-weight: bold; padding: 8px;">' +
                    $(this).text().trim() + '</th>';
            }
        });
        html += '</tr></thead>';

        // Cuerpo de la tabla
        html += '<tbody>';
        $('#tablaEmpleados tbody tr').each(function () {
            html += '<tr>';
            $(this).find('td').each(function (index) {
                const totalColumns = $(this).parent().find('td').length;
                const isLast = index === totalColumns - 1;
                if (!excludeIndexes.includes(index) && !isLast) {
                    const content = $(this).text().trim()
                        .replace(/\s+/g, ' ')
                        .replace(/<[^>]*>/g, '');
                    html += '<td style="padding: 5px;">' + content + '</td>';
                }
            });
            html += '</tr>';
        });
        html += '</tbody></table>';

        // Descargar archivo
        setTimeout(() => {
            try {
                const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'LISTA-USUARIOS-' + formatDate(new Date()) + '.xls';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                Swal.fire({
                    icon: 'success',
                    title: 'Exportación completada',
                    text: 'El archivo Excel se ha generado correctamente',
                    timer: 2000,
                    showConfirmButton: false
                });
            } catch (error) {
                console.error('Error al exportar:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Ocurrió un error al generar el Excel'
                });
            } finally {
                $('#btnExportExcel').html(originalHtml).prop('disabled', false);
            }
        }, 500);
    });



        // Función auxiliar para formatear fecha (añádela si no existe)
        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }
        // Botón de ver detalles
        $('.btn-view').on('click', function () {
            var id = $(this).data('id');

            $('#contenidoEmpleado').html('<div class="text-center">Cargando...</div>');

            $.ajax({
                url: '@Url.Action("DetallesUsuario", "Usuarios")',
                type: 'GET',
                data: { id: id },
                    success: function (emp) {
                        // Formateador de fechas
                        const formatDate = (dateString) => {
                            if (!dateString) return 'No especificado';
                            const options = { day: '2-digit', month: 'long', year: 'numeric' };
                            return new Date(dateString).toLocaleDateString('es-ES', options);
                        };

                        let html = `
                        <div class="card shadow-lg border-0 rounded-4 overflow-hidden animate__animated animate__fadeIn">
                            <div class="card-header bg-primary text-white py-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">
                                        <i class="fas fa-user-tie me-2"></i>Detalles del Usuario
                                    </h5>
                                </div>
                            </div>

                            <div class="card-body p-4">
                                <div class="row g-4">
                                    <!-- Columna Izquierda: Foto y datos básicos -->
                                    <div class="col-lg-4">
                                        <div class="sticky-top" style="top: 20px;">
                                            <div class="text-center mb-4">
                                                <div class="avatar-container position-relative mx-auto">
                                                    <img src="${emp.imagePath || '/img/logo.png'}"
                                                         class="img-fluid rounded-circle shadow-lg employee-avatar hover-zoom"
                                                         alt="Foto de ${emp.nombreCompleto}">
                                                    <span class="status-badge ${emp.activo ? 'bg-success' : 'bg-secondary'}">
                                                        <i class="fas fa-circle"></i>
                                                    </span>
                                                </div>
                                                <h3 class="mt-3 mb-1 fw-bold text-gradient">${emp.nombreCompleto}</h3>
                                                <p class="text-muted mb-2">
                                                    <i class="fas fa-user-circle me-1"></i> ${emp.usuario}
                                                </p>

                                                <div class="d-flex justify-content-center gap-2 flex-wrap mb-3">
                                                    ${emp.gruposAsignados ?
                                                      `<span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-10 py-2 px-3 rounded-pill">
                                                        <i class="fas fa-users me-1"></i> ${emp.gruposAsignados}
                                                       </span>` :
                                                      '<span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-10">Sin grupo asignado</span>'}
                                                </div>

                                                <div class="card shadow-sm border-0 mb-3">
                                                    <div class="card-body p-3">
                                                        <div class="d-flex justify-content-around text-center">
                                                            <div class="px-2">
                                                                <div class="text-muted small">Edad</div>
                                                                <div class="fw-bold fs-5">${emp.edad}</div>
                                                            </div>
                                                            <div class="border-start px-2">
                                                                <div class="text-muted small">Género</div>
                                                                <div class="fw-bold fs-5">${emp.generoDesc}</div>
                                                            </div>
                                                            <div class="border-start px-2">
                                                                <div class="text-muted small">Estado</div>
                                                                <div class="fw-bold fs-5 text-success">Activo</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Columna Derecha: Detalles -->
                                    <div class="col-lg-8">
                                        <div class="accordion custom-accordion" id="empleadoAccordion">
                                            <!-- Sección Información Personal -->
                                            <div class="accordion-item border-0 mb-3 shadow-sm">
                                                <h2 class="accordion-header" id="headingPersonal">
                                                    <button class="accordion-button collapsed rounded-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePersonal" aria-expanded="true" aria-controls="collapsePersonal">
                                                        <i class="fas fa-id-card me-2 text-primary"></i> Información Personal
                                                    </button>
                                                </h2>
                                                <div id="collapsePersonal" class="accordion-collapse collapse show" aria-labelledby="headingPersonal" data-bs-parent="#empleadoAccordion">
                                                    <div class="accordion-body pt-0">
                                                        <div class="row g-3">
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-id-badge me-2 text-muted"></i>DNI:</span>
                                                                    <span class="detail-value">${emp.dni}</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-heart me-2 text-muted"></i>Estado Civil:</span>
                                                                    <span class="detail-value">${emp.estadoCivil || 'No especificado'}</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-birthday-cake me-2 text-muted"></i>Fecha Nacimiento:</span>
                                                                    <span class="detail-value">${(emp.fechaNacimiento)}</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-map-marker-alt me-2 text-muted"></i>Nacionalidad:</span>
                                                                    <span class="detail-value">Peruana</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Sección Contacto -->
                                            <div class="accordion-item border-0 mb-3 shadow-sm">
                                                <h2 class="accordion-header" id="headingContacto">
                                                    <button class="accordion-button collapsed rounded-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseContacto" aria-expanded="false" aria-controls="collapseContacto">
                                                        <i class="fas fa-address-book me-2 text-primary"></i> Datos de Contacto
                                                    </button>
                                                </h2>
                                                <div id="collapseContacto" class="accordion-collapse collapse" aria-labelledby="headingContacto" data-bs-parent="#empleadoAccordion">
                                                    <div class="accordion-body pt-0">
                                                        <div class="row g-3">
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-envelope me-2 text-muted"></i>Email:</span>
                                                                    <a href="mailto:${emp.email}" class="detail-value text-primary">${emp.email}</a>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-phone-alt me-2 text-muted"></i>Teléfono:</span>
                                                                    <span class="detail-value">${emp.telefono || 'No Implementado'}</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-12">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-map-marked-alt me-2 text-muted"></i>Dirección:</span>
                                                                    <span class="detail-value">${emp.direccionCompleta || 'No especificada'}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Sección Historial -->
                                            <div class="accordion-item border-0 mb-3 shadow-sm">
                                                <h2 class="accordion-header" id="headingHistorial">
                                                    <button class="accordion-button collapsed rounded-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHistorial" aria-expanded="false" aria-controls="collapseHistorial">
                                                        <i class="fas fa-history me-2 text-primary"></i> Historial
                                                    </button>
                                                </h2>
                                                <div id="collapseHistorial" class="accordion-collapse collapse" aria-labelledby="headingHistorial" data-bs-parent="#empleadoAccordion">
                                                    <div class="accordion-body pt-0">
                                                        <div class="row g-3">
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-calendar-plus me-2 text-muted"></i>Fecha Registro:</span>
                                                                    <span class="detail-value">${emp.fechaRegistro || 'No actualizado'}</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="detail-item">
                                                                    <span class="detail-label"><i class="fas fa-calendar-check me-2 text-muted"></i>Última Actualización:</span>
                                                                    <span class="detail-value">${emp.fechaActualizacion || 'No actualizado'}</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-12">
                                                                <div class="timeline">
                                                                    <div class="timeline-item">
                                                                        <div class="timeline-badge bg-primary">
                                                                            <i class="fas fa-user-plus"></i>
                                                                        </div>
                                                                        <div class="timeline-content">
                                                                            <h6>Registro inicial</h6>
                                                                            <p class="text-muted small mb-0">${emp.fechaRegistro || 'No actualizado'}</p>
                                                                        </div>
                                                                    </div>
                                                                    ${emp.fechaActualizacion ? `
                                                                    <div class="timeline-item">
                                                                        <div class="timeline-badge bg-success">
                                                                            <i class="fas fa-user-edit"></i>
                                                                        </div>
                                                                        <div class="timeline-content">
                                                                            <h6>Última actualización</h6>
                                                                            <p class="text-muted small mb-0">${emp.fechaActualizacion || 'No actualizado'}</p>
                                                                        </div>
                                                                    </div>
                                                                    ` : ''}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Sección de Acciones -->
                                        <div class="d-flex justify-content-end gap-2 mt-4">
                                            <button class="btn btn-primary btn-sm rounded-pill action-btn" id="btnEditarEmpleado">
                                                <i class="fas fa-user-edit me-1"></i> Editar Usuario
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;

                        $('#contenidoEmpleado').html(html);
                        $('#modalEmpleado').modal('show');

                        // Efecto hover para elementos interactivos
                        $('.action-btn').hover(
                            function() { $(this).addClass('shadow'); },
                            function() { $(this).removeClass('shadow'); }
                        );

                        // Efecto al hacer hover en la foto
                        $('.employee-avatar').hover(
                            function() { $(this).css('transform', 'scale(1.05)'); },
                            function() { $(this).css('transform', 'scale(1)'); }
                        );

                        // Inicializar tooltips
                        $('[data-bs-toggle="tooltip"]').tooltip();
                    },

            error: function () {
                let errorHtml = `
                <div class="error-container animate__animated animate__shakeX">
                    <div class="error-card text-center py-5">
                        <div class="error-icon mb-4">
                            <i class="fas fa-exclamation-triangle fa-4x text-danger"></i>
                        </div>
                        <h3 class="fw-bold text-danger mb-3">¡Error al cargar los datos!</h3>
                        <p class="text-muted mb-4">No se pudo obtener la información del empleado. Por favor, intente nuevamente.</p>

                        <div class="progress mb-3 d-none" id="retryProgress" style="height: 6px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger"
                                 role="progressbar" style="width: 100%"></div>
                        </div>

                        <div class="d-flex justify-content-center gap-3" id="errorButtons">
                            <button class="btn btn-outline-danger btn-retry">
                                <i class="fas fa-sync-alt me-2"></i> Reintentar
                            </button>
                            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i> Cerrar
                            </button>
                        </div>

                        <div class="mt-4 pt-3 border-top">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i> Si el problema persiste, contacte al administrador.
                            </small>
                        </div>
                    </div>
                </div>
                `;

                $('#contenidoEmpleado').html(errorHtml);
                $('#modalEmpleado').modal('show');

                // Función para manejar el reintento
                $('.btn-retry').click(function() {
                    const $progress = $('#retryProgress');
                    const $buttons = $('#errorButtons');
                    const $errorContainer = $('.error-card');

                    // Mostrar progreso y ocultar botones
                    $buttons.addClass('d-none');
                    $progress.removeClass('d-none');
                    $errorContainer.find('p').text('Intentando recuperar la información...');

                    // Configurar timeout de 10 segundos
                    const timeout = setTimeout(() => {
                        $errorContainer.html(`
                            <div class="py-4">
                                <i class="fas fa-exclamation-circle fa-3x text-danger mb-3"></i>
                                <h4 class="fw-bold text-danger">Tiempo de espera agotado</h4>
                                <p class="text-muted">El sistema no respondió en el tiempo esperado.</p>
                                <button class="btn btn-outline-danger mt-3" onclick="location.reload()">
                                    <i class="fas fa-redo me-2"></i> Recargar página
                                </button>
                            </div>
                        `);
                    }, 10000); // 10 segundos

                    // Función para cargar los datos (reemplaza con tu función real)
                    const loadData = () => {
                        $.ajax({
                            url: tu_url_de_carga,
                            method: 'GET',
                            success: function(response) {
                                clearTimeout(timeout); // Cancelar el timeout si tiene éxito
                                // Aquí procesas la respuesta exitosa
                            },
                            error: function() {
                                clearTimeout(timeout);
                                $errorContainer.html(`
                                    <div class="py-4">
                                        <i class="fas fa-times-circle fa-3x text-danger mb-3"></i>
                                        <h4 class="fw-bold text-danger">Error nuevamente</h4>
                                        <p class="text-muted">No se pudo recuperar la información.</p>
                                        <button class="btn btn-outline-danger mt-3" onclick="location.reload()">
                                            <i class="fas fa-redo me-2"></i> Recargar página
                                        </button>
                                    </div>
                                `);
                            }
                        });
                    };

                    // Iniciar la carga de datos
                    loadData();
                });
            }
            });
        });
    });



</script>
