@{
    ViewData["Title"] = "Registrar Usuario";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: url('/images/admin-bg.jpg') no-repeat center center fixed;
            background-size: cover;
        }

        .registro-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            max-width: 800px;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
            transition: transform 0.3s ease-in-out;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: scale(1.05);
            }

        .form-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .section-title {
            color: #007bff;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .required-field::after {
            content: " *";
            color: red;
        }
    </style>
</head>
<body>

    <div class="container d-flex justify-content-center align-items-center vh-100">
        <div class="registro-card">
            <h3 class="text-center fw-bold text-primary mb-3">
                <i class="fas fa-user-plus me-2"></i>Registro de Empleado
            </h3>
            <p class="text-muted text-center mb-4">Complete todos los campos para registrar un nuevo empleado</p>

            <form id="formRegistro">
                <!-- Sección Datos de Acceso -->
                <div class="form-section">
                    <h5 class="section-title"><i class="fas fa-key me-2"></i>Datos de Acceso</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label required-field">Usuario</label>
                            <input type="text" class="form-control rounded-3" id="usuario" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label required-field">Contraseña</label>
                            <div class="input-group">
                                <input type="password" class="form-control rounded-3" id="contrasenia" required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label required-field">Email</label>
                            <input type="email" class="form-control rounded-3" id="email" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label required-field">Rol</label>
                            <select class="form-select rounded-3" id="idRol" required>
                                <option value="" selected disabled>Seleccione un rol</option>
                                <option value="ROL001">Administrador</option>
                                <option value="ROL002">Usuario</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Sección Datos Personales -->
                <div class="form-section">
                    <h5 class="section-title"><i class="fas fa-user me-2"></i>Datos Personales</h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label required-field">Nombres</label>
                            <input type="text" class="form-control rounded-3" id="nombres" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label required-field">Apellido Paterno</label>
                            <input type="text" class="form-control rounded-3" id="apePat" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Apellido Materno</label>
                            <input type="text" class="form-control rounded-3" id="apeMat">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label required-field">DNI</label>
                            <input type="text" class="form-control rounded-3" id="dni" maxlength="8" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label required-field">Fecha Nacimiento</label>
                            <input type="date" class="form-control rounded-3" id="fechaNacimiento" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label required-field">Género</label>
                            <select class="form-select rounded-3" id="genero" required>
                                <option value="" selected disabled>Seleccione</option>
                                <option value="M">Masculino</option>
                                <option value="F">Femenino</option>
                                <option value="O">Otro</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label required-field">Estado Civil</label>
                            <select class="form-select rounded-3" id="estadoCivil" required>
                                <option value="" selected disabled>Seleccione</option>
                                <option value="Soltero/a">Soltero/a</option>
                                <option value="Casado/a">Casado/a</option>
                                <option value="Divorciado/a">Divorciado/a</option>
                                <option value="Viudo/a">Viudo/a</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Sección Dirección -->
                <div class="form-section">
                    <h5 class="section-title"><i class="fas fa-map-marker-alt me-2"></i>Dirección</h5>
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label required-field">Dirección</label>
                            <input type="text" class="form-control rounded-3" id="direccion" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label required-field">Departamento</label>
                            <input type="text" class="form-control rounded-3" id="departamento" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label required-field">Provincia</label>
                            <input type="text" class="form-control rounded-3" id="provincia" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label required-field">Distrito</label>
                            <input type="text" class="form-control rounded-3" id="distrito" required>
                        </div>
                    </div>
                </div>

                <!-- Sección Laboral -->
                <div class="form-section">
                    <h5 class="section-title"><i class="fas fa-briefcase me-2"></i>Datos Laborales</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label required-field">Grupo</label>
                            <select class="form-select rounded-3" id="idGrupo" required>
                                <option value="" selected disabled>Seleccione un grupo</option>
                                <option value="GRP001">Grupo 1</option>
                                <option value="GRP002">Grupo 2</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label required-field">Tipo</label>
                            <select class="form-select rounded-3" id="tipo" required>
                                <option value="" selected disabled>Seleccione tipo</option>
                                <option value="1">Tipo 1</option>
                                <option value="2">Tipo 2</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Foto de perfil (opcional)</label>
                            <input type="file" class="form-control rounded-3" id="imageFile" accept="image/*">
                        </div>
                    </div>
                </div>

                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary rounded-pill py-2">
                        <i class="fas fa-save me-2"></i>Registrar Empleado
                    </button>
                </div>
            </form>

            <div id="mensaje" class="mt-3"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Toggle para mostrar/ocultar contraseña
            document.getElementById("togglePassword").addEventListener("click", function() {
                const passwordInput = document.getElementById("contrasenia");
                const icon = this.querySelector("i");

                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    icon.classList.replace("fa-eye", "fa-eye-slash");
                } else {
                    passwordInput.type = "password";
                    icon.classList.replace("fa-eye-slash", "fa-eye");
                }
            });

            // Validación de formulario
            document.getElementById("formRegistro").addEventListener("submit", function (event) {
                event.preventDefault();

                // Validar edad mínima (18 años)
                const fechaNacimiento = new Date(document.getElementById("fechaNacimiento").value);
                const hoy = new Date();
                const edadMinima = new Date(fechaNacimiento.getFullYear() + 18, fechaNacimiento.getMonth(), fechaNacimiento.getDate());

                if (hoy < edadMinima) {
                    showMessage("El empleado debe tener al menos 18 años", "danger");
                    return;
                }

                // Validar DNI (8 dígitos)
                const dni = document.getElementById("dni").value;
                if (!/^\d{8}$/.test(dni)) {
                    showMessage("El DNI debe tener 8 dígitos", "danger");
                    return;
                }

                // Crear objeto con los datos
                const datos = {
                    usuario: document.getElementById("usuario").value,
                    email: document.getElementById("email").value,
                    contrasenia: document.getElementById("contrasenia").value,
                    idRol: document.getElementById("idRol").value,
                    nombres: document.getElementById("nombres").value,
                    apePat: document.getElementById("apePat").value,
                    apeMat: document.getElementById("apeMat").value,
                    dni: dni,
                    fechaNacimiento: document.getElementById("fechaNacimiento").value,
                    genero: document.getElementById("genero").value,
                    direccion: document.getElementById("direccion").value,
                    departamento: document.getElementById("departamento").value,
                    provincia: document.getElementById("provincia").value,
                    distrito: document.getElementById("distrito").value,
                    estadoCivil: document.getElementById("estadoCivil").value,
                    idGrupo: document.getElementById("idGrupo").value,
                    tipo: parseInt(document.getElementById("tipo").value),
                    imagePath: "" // Se manejaría diferente si se sube una imagen
                };

                // Enviar datos al servidor
                fetch("/Usuarios/RegistrarUsuario", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(datos)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Error en la respuesta del servidor");
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        showMessage(data.message, "success");
                        document.getElementById("formRegistro").reset();
                    } else {
                        showMessage(data.message, "danger");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    showMessage("Error al registrar el empleado: " + error.message, "danger");
                });
            });

            function showMessage(message, type) {
                const mensajeDiv = document.getElementById("mensaje");
                mensajeDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;

                // Auto-ocultar después de 5 segundos
                setTimeout(() => {
                    mensajeDiv.innerHTML = "";
                }, 5000);
            }
        });
    </script>
</body>
</html>